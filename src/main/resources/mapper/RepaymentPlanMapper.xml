<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xiaochong.loan.background.mapper.RepaymentPlanMapper">
  <resultMap id="BaseResultMap" type="com.xiaochong.loan.background.entity.po.RepaymentPlan">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="merch_id" jdbcType="INTEGER" property="merchId" />
    <result column="borrower_id" jdbcType="INTEGER" property="borrowerId" />
    <result column="application_id" jdbcType="INTEGER" property="applicationId" />
    <result column="stage_no" jdbcType="INTEGER" property="stageNo" />
    <result column="return_time" jdbcType="TIMESTAMP" property="returnTime" />
    <result column="principal_money" jdbcType="DECIMAL" property="principalMoney" />
    <result column="interest" jdbcType="DECIMAL" property="interest" />
    <result column="punish_interest" jdbcType="DECIMAL" property="punishInterest" />
    <result column="whole_money" jdbcType="DECIMAL" property="wholeMoney" />
    <result column="status" jdbcType="VARCHAR" property="status" />
    <result column="overdue_days" jdbcType="INTEGER" property="overdueDays" />
    <result column="practical_time" jdbcType="TIMESTAMP" property="practicalTime" />
    <result column="reductive_money" jdbcType="DECIMAL" property="reductiveMoney" />
    <result column="repayment_user" jdbcType="INTEGER" property="repaymentUser" />
    <result column="repayment_time" jdbcType="TIMESTAMP" property="repaymentTime" />
    <result column="create_by" jdbcType="INTEGER" property="createBy" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_by" jdbcType="INTEGER" property="updateBy" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, merch_id, borrower_id, application_id, stage_no, return_time, principal_money, 
    interest, punish_interest, whole_money, status, overdue_days, practical_time, reductive_money, 
    repayment_user, repayment_time, create_by, create_time, update_by, update_time
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from loan_repayment_plan
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from loan_repayment_plan
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.xiaochong.loan.background.entity.po.RepaymentPlan">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into loan_repayment_plan (id, merch_id, borrower_id, 
      application_id, stage_no, return_time, 
      principal_money, interest, punish_interest, 
      whole_money, status, overdue_days, 
      practical_time, reductive_money, repayment_user, 
      repayment_time, create_by, create_time, 
      update_by, update_time)
    values (#{id,jdbcType=INTEGER}, #{merchId,jdbcType=INTEGER}, #{borrowerId,jdbcType=INTEGER}, 
      #{applicationId,jdbcType=INTEGER}, #{stageNo,jdbcType=INTEGER}, #{returnTime,jdbcType=TIMESTAMP}, 
      #{principalMoney,jdbcType=DECIMAL}, #{interest,jdbcType=DECIMAL}, #{punishInterest,jdbcType=DECIMAL}, 
      #{wholeMoney,jdbcType=DECIMAL}, #{status,jdbcType=VARCHAR}, #{overdueDays,jdbcType=INTEGER}, 
      #{practicalTime,jdbcType=TIMESTAMP}, #{reductiveMoney,jdbcType=DECIMAL}, #{repaymentUser,jdbcType=INTEGER}, 
      #{repaymentTime,jdbcType=TIMESTAMP}, #{createBy,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}, 
      #{updateBy,jdbcType=INTEGER}, #{updateTime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.xiaochong.loan.background.entity.po.RepaymentPlan">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into loan_repayment_plan
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="merchId != null">
        merch_id,
      </if>
      <if test="borrowerId != null">
        borrower_id,
      </if>
      <if test="applicationId != null">
        application_id,
      </if>
      <if test="stageNo != null">
        stage_no,
      </if>
      <if test="returnTime != null">
        return_time,
      </if>
      <if test="principalMoney != null">
        principal_money,
      </if>
      <if test="interest != null">
        interest,
      </if>
      <if test="punishInterest != null">
        punish_interest,
      </if>
      <if test="wholeMoney != null">
        whole_money,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="overdueDays != null">
        overdue_days,
      </if>
      <if test="practicalTime != null">
        practical_time,
      </if>
      <if test="reductiveMoney != null">
        reductive_money,
      </if>
      <if test="repaymentUser != null">
        repayment_user,
      </if>
      <if test="repaymentTime != null">
        repayment_time,
      </if>
      <if test="createBy != null">
        create_by,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateBy != null">
        update_by,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="merchId != null">
        #{merchId,jdbcType=INTEGER},
      </if>
      <if test="borrowerId != null">
        #{borrowerId,jdbcType=INTEGER},
      </if>
      <if test="applicationId != null">
        #{applicationId,jdbcType=INTEGER},
      </if>
      <if test="stageNo != null">
        #{stageNo,jdbcType=INTEGER},
      </if>
      <if test="returnTime != null">
        #{returnTime,jdbcType=TIMESTAMP},
      </if>
      <if test="principalMoney != null">
        #{principalMoney,jdbcType=DECIMAL},
      </if>
      <if test="interest != null">
        #{interest,jdbcType=DECIMAL},
      </if>
      <if test="punishInterest != null">
        #{punishInterest,jdbcType=DECIMAL},
      </if>
      <if test="wholeMoney != null">
        #{wholeMoney,jdbcType=DECIMAL},
      </if>
      <if test="status != null">
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="overdueDays != null">
        #{overdueDays,jdbcType=INTEGER},
      </if>
      <if test="practicalTime != null">
        #{practicalTime,jdbcType=TIMESTAMP},
      </if>
      <if test="reductiveMoney != null">
        #{reductiveMoney,jdbcType=DECIMAL},
      </if>
      <if test="repaymentUser != null">
        #{repaymentUser,jdbcType=INTEGER},
      </if>
      <if test="repaymentTime != null">
        #{repaymentTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createBy != null">
        #{createBy,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null">
        #{updateBy,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.xiaochong.loan.background.entity.po.RepaymentPlan">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update loan_repayment_plan
    <set>
      <if test="merchId != null">
        merch_id = #{merchId,jdbcType=INTEGER},
      </if>
      <if test="borrowerId != null">
        borrower_id = #{borrowerId,jdbcType=INTEGER},
      </if>
      <if test="applicationId != null">
        application_id = #{applicationId,jdbcType=INTEGER},
      </if>
      <if test="stageNo != null">
        stage_no = #{stageNo,jdbcType=INTEGER},
      </if>
      <if test="returnTime != null">
        return_time = #{returnTime,jdbcType=TIMESTAMP},
      </if>
      <if test="principalMoney != null">
        principal_money = #{principalMoney,jdbcType=DECIMAL},
      </if>
      <if test="interest != null">
        interest = #{interest,jdbcType=DECIMAL},
      </if>
      <if test="punishInterest != null">
        punish_interest = #{punishInterest,jdbcType=DECIMAL},
      </if>
      <if test="wholeMoney != null">
        whole_money = #{wholeMoney,jdbcType=DECIMAL},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="overdueDays != null">
        overdue_days = #{overdueDays,jdbcType=INTEGER},
      </if>
      <if test="practicalTime != null">
        practical_time = #{practicalTime,jdbcType=TIMESTAMP},
      </if>
      <if test="reductiveMoney != null">
        reductive_money = #{reductiveMoney,jdbcType=DECIMAL},
      </if>
      <if test="repaymentUser != null">
        repayment_user = #{repaymentUser,jdbcType=INTEGER},
      </if>
      <if test="repaymentTime != null">
        repayment_time = #{repaymentTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createBy != null">
        create_by = #{createBy,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null">
        update_by = #{updateBy,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.xiaochong.loan.background.entity.po.RepaymentPlan">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update loan_repayment_plan
    set merch_id = #{merchId,jdbcType=INTEGER},
      borrower_id = #{borrowerId,jdbcType=INTEGER},
      application_id = #{applicationId,jdbcType=INTEGER},
      stage_no = #{stageNo,jdbcType=INTEGER},
      return_time = #{returnTime,jdbcType=TIMESTAMP},
      principal_money = #{principalMoney,jdbcType=DECIMAL},
      interest = #{interest,jdbcType=DECIMAL},
      punish_interest = #{punishInterest,jdbcType=DECIMAL},
      whole_money = #{wholeMoney,jdbcType=DECIMAL},
      status = #{status,jdbcType=VARCHAR},
      overdue_days = #{overdueDays,jdbcType=INTEGER},
      practical_time = #{practicalTime,jdbcType=TIMESTAMP},
      reductive_money = #{reductiveMoney,jdbcType=DECIMAL},
      repayment_user = #{repaymentUser,jdbcType=INTEGER},
      repayment_time = #{repaymentTime,jdbcType=TIMESTAMP},
      create_by = #{createBy,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_by = #{updateBy,jdbcType=INTEGER},
      update_time = #{updateTime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update>
    <select id="selectRepaymentPlan" parameterType="com.xiaochong.loan.background.entity.po.RepaymentPlan" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List" />
        from loan_repayment_plan
        where 1=1
        <if test="merchId != null">
          AND  merch_id = #{merchId,jdbcType=INTEGER}
        </if>
        <if test="borrowerId != null">
          AND  borrower_id = #{borrowerId,jdbcType=INTEGER}
        </if>
        <if test="applicationId != null">
          AND  application_id = #{applicationId,jdbcType=INTEGER}
        </if>
        <if test="stageNo != null">
            AND stage_no = #{stageNo,jdbcType=INTEGER}
        </if>
        <if test="returnTime != null">
            AND return_time = #{returnTime,jdbcType=TIMESTAMP}
        </if>
        <if test="principalMoney != null">
            AND principal_money = #{principalMoney,jdbcType=DECIMAL}
        </if>
        <if test="interest != null">
            AND interest = #{interest,jdbcType=DECIMAL}
        </if>
        <if test="punishInterest != null">
            AND punish_interest = #{punishInterest,jdbcType=DECIMAL}
        </if>
        <if test="wholeMoney != null">
            AND whole_money = #{wholeMoney,jdbcType=DECIMAL}
        </if>
        <if test="status != null">
            AND status = #{status,jdbcType=VARCHAR}
        </if>
        <if test="overdueDays != null">
            AND overdue_days = #{overdueDays,jdbcType=INTEGER}
        </if>
        <if test="practicalTime != null">
            AND practical_time = #{practicalTime,jdbcType=TIMESTAMP}
        </if>
        <if test="reductiveMoney != null">
            AND  reductive_money = #{reductiveMoney,jdbcType=DECIMAL}
        </if>
        <if test="createBy != null">
            AND create_by = #{createBy,jdbcType=INTEGER}
        </if>
        <if test="createTime != null">
            AND create_time = #{createTime,jdbcType=TIMESTAMP}
        </if>
        <if test="updateBy != null">
            AND update_by = #{updateBy,jdbcType=INTEGER}
        </if>
        <if test="updateTime != null">
            AND  update_time = #{updateTime,jdbcType=TIMESTAMP}
        </if>
        <if test="repaymentUser != null">
            AND repayment_user = #{repaymentUser,jdbcType=INTEGER}
        </if>
        <if test="repaymentTime != null">
            AND repayment_time = #{repaymentTime,jdbcType=TIMESTAMP}
        </if>
        ORDER BY return_time
    </select>
    <select id="selectRepaymentPlanByApplicationId" parameterType="com.xiaochong.loan.background.entity.po.RepaymentPlan" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List" />
        from loan_repayment_plan
        where  application_id = #{applicationId,jdbcType=INTEGER}
        ORDER  BY  stage_no
    </select>
  <select id="listByApplicationIdStatus" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List" />
        from loan_repayment_plan
        where  application_id = #{applicationId}
        AND status != #{status}
        ORDER  BY  stage_no
    </select>
    <!--<result column="whole_money" jdbcType="DECIMAL" property="wholeMoney" />-->
    <!--<result column="status" jdbcType="VARCHAR" property="status" />-->
    <select id="selectByLoanApplicationIds" parameterType="com.xiaochong.loan.background.entity.po.RepaymentPlan" resultType="com.xiaochong.loan.background.entity.po.RepaymentPlan">
        select
        whole_money wholeMoney,
        status status
        from loan_repayment_plan
        where  application_id IN
        <foreach close=")" collection="loanApplicationIds" item="id" open="(" separator=",">
            #{id}
        </foreach>
        AND (status = '1' OR status  = '3')
    </select>

    <select id="selectRepaymentPlanRecord" parameterType="com.xiaochong.loan.background.entity.po.RepaymentPlan" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List" />
        from loan_repayment_plan
        where 1=1
        <if test="applicationId != null">
            AND  application_id = #{applicationId,jdbcType=INTEGER}
        </if>
        <if test="status == 1 or status == 2 or status == 3">
            AND status = #{status,jdbcType=VARCHAR}
        </if>
        <if test="merchId != null">
            AND  merch_id = #{merchId,jdbcType=INTEGER}
        </if>
        <if test="borrowerId != null">
            AND  borrower_id = #{borrowerId,jdbcType=INTEGER}
        </if>
        <if test="status == 4">
            AND overdue_days &gt;0 AND status ='2'
        </if>
        <if test="applicationIds != null ">
         AND   application_id IN
            <foreach close=")" collection="applicationIds" item="aid" open="(" separator=",">
                #{aid}
            </foreach>
        </if>
        ORDER BY return_time
    </select>
    <select id="selectListByRepaymentPlanRecord" parameterType="com.xiaochong.loan.background.entity.po.RepaymentPlan" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List" />
        from loan_repayment_plan
        where 1=1
        <if test="applicationId != null">
            AND  application_id = #{applicationId,jdbcType=INTEGER}
        </if>
        <if test="merchId != null">
            AND  merch_id = #{merchId,jdbcType=INTEGER}
        </if>
        <if test="status == 1">
            AND  (status ='1' or status ='3')
        </if>
        <if test="status == 2 ">
            AND status = '2' AND overdue_days =0
        </if>
        <if test="borrowerId != null">
            AND  borrower_id = #{borrowerId,jdbcType=INTEGER}
        </if>
        <if test="status == 4">
            AND overdue_days &gt;0 AND status ='2'
        </if>
        <if test="applicationIds != null ">
         AND   application_id IN
            <foreach close=")" collection="applicationIds" item="aid" open="(" separator=",">
                #{aid}
            </foreach>
        </if>
        ORDER BY return_time
    </select>

    <select id="selectOverDueInfos" resultMap="BaseResultMap">
        SELECT
        borrower_id,
        whole_money,
        application_id,
        stage_no,
        id
        FROM
        loan_repayment_plan
        WHERE
        STATUS = 3
        ORDER BY whole_money DESC
    </select>

    <select id="selectOverDueStatistics" resultType="java.util.Map">
       SELECT
            borrower_id,
            application_id,
            max(overdue_days) max_overdue_days,
             SUM(whole_money) over_due_whole_money,
             count(1) over_due_number
        FROM
            loan_repayment_plan
        WHERE
            STATUS = 3
        GROUP BY
            application_id
    </select>

    <select id="selectCountByRepaymentPlan" parameterType="com.xiaochong.loan.background.entity.po.RepaymentSerialRecord" resultType="java.lang.Integer">
        select
        COUNT(1)
        from loan_repayment_plan
        where 1=1
        <if test="merchId != null">
            AND  merch_id = #{merchId,jdbcType=INTEGER}
        </if>
        <if test="borrowerId != null">
            AND  borrower_id = #{borrowerId,jdbcType=INTEGER}
        </if>
        <if test="applicationId != null">
            AND  application_id = #{applicationId,jdbcType=INTEGER}
        </if>
        <if test="stageNo != null">
            AND stage_no = #{stageNo,jdbcType=INTEGER}
        </if>
        <if test="status != null">
            AND status = #{status,jdbcType=VARCHAR}
        </if>
    </select>


</mapper>