<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xiaochong.loan.background.mapper.OrderFlowMapper" >
  <resultMap id="BaseResultMap" type="com.xiaochong.loan.background.entity.po.OrderFlow" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="order_no" property="orderNo" jdbcType="VARCHAR" />
    <result column="order_token" property="orderToken" jdbcType="VARCHAR" />
    <result column="merch_id" property="merchId" jdbcType="INTEGER" />
    <result column="flow_no" property="flowNo" jdbcType="VARCHAR" />
    <result column="flow_step" property="flowStep" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="CHAR" />
    <result column="createtime" property="createtime" jdbcType="TIMESTAMP" />
    <result column="updatetime" property="updatetime" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, order_no, order_token, merch_id, flow_no, flow_step, status, createtime, updatetime
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from loan_order_flow
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from loan_order_flow
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.xiaochong.loan.background.entity.po.OrderFlow" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into loan_order_flow (id, order_no, order_token, 
      merch_id, flow_no, flow_step, 
      status, createtime, updatetime
      )
    values (#{id,jdbcType=INTEGER}, #{orderNo,jdbcType=VARCHAR}, #{orderToken,jdbcType=VARCHAR}, 
      #{merchId,jdbcType=INTEGER}, #{flowNo,jdbcType=VARCHAR}, #{flowStep,jdbcType=INTEGER}, 
      #{status,jdbcType=CHAR}, #{createtime,jdbcType=TIMESTAMP}, #{updatetime,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.xiaochong.loan.background.entity.po.OrderFlow" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into loan_order_flow
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="orderNo != null" >
        order_no,
      </if>
      <if test="orderToken != null" >
        order_token,
      </if>
      <if test="merchId != null" >
        merch_id,
      </if>
      <if test="flowNo != null" >
        flow_no,
      </if>
      <if test="flowStep != null" >
        flow_step,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="createtime != null" >
        createtime,
      </if>
      <if test="updatetime != null" >
        updatetime,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="orderNo != null" >
        #{orderNo,jdbcType=VARCHAR},
      </if>
      <if test="orderToken != null" >
        #{orderToken,jdbcType=VARCHAR},
      </if>
      <if test="merchId != null" >
        #{merchId,jdbcType=INTEGER},
      </if>
      <if test="flowNo != null" >
        #{flowNo,jdbcType=VARCHAR},
      </if>
      <if test="flowStep != null" >
        #{flowStep,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        #{status,jdbcType=CHAR},
      </if>
      <if test="createtime != null" >
        #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="updatetime != null" >
        #{updatetime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.xiaochong.loan.background.entity.po.OrderFlow" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update loan_order_flow
    <set >
      <if test="orderNo != null" >
        order_no = #{orderNo,jdbcType=VARCHAR},
      </if>
      <if test="orderToken != null" >
        order_token = #{orderToken,jdbcType=VARCHAR},
      </if>
      <if test="merchId != null" >
        merch_id = #{merchId,jdbcType=INTEGER},
      </if>
      <if test="flowNo != null" >
        flow_no = #{flowNo,jdbcType=VARCHAR},
      </if>
      <if test="flowStep != null" >
        flow_step = #{flowStep,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=CHAR},
      </if>
      <if test="createtime != null" >
        createtime = #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="updatetime != null" >
        updatetime = #{updatetime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.xiaochong.loan.background.entity.po.OrderFlow" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update loan_order_flow
    set order_no = #{orderNo,jdbcType=VARCHAR},
      order_token = #{orderToken,jdbcType=VARCHAR},
      merch_id = #{merchId,jdbcType=INTEGER},
      flow_no = #{flowNo,jdbcType=VARCHAR},
      flow_step = #{flowStep,jdbcType=INTEGER},
      status = #{status,jdbcType=CHAR},
      createtime = #{createtime,jdbcType=TIMESTAMP},
      updatetime = #{updatetime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update>


  <select id="getByOrderFlow" resultMap="BaseResultMap" parameterType="com.xiaochong.loan.background.entity.po.OrderFlow" >
    select
    <include refid="Base_Column_List" />
    from loan_order_flow
    where 1=1
    <if test="id != null" >
      AND id = #{id,jdbcType=INTEGER}
    </if>
    <if test="orderNo != null" >
      AND order_no = #{orderNo,jdbcType=VARCHAR}
    </if>
    <if test="orderToken != null" >
      AND order_token = #{orderToken,jdbcType=VARCHAR}
    </if>
    <if test="merchId != null" >
      AND merch_id = #{merchId,jdbcType=INTEGER}
    </if>
    <if test="flowNo != null" >
      AND flow_no = #{flowNo,jdbcType=VARCHAR}
    </if>
    <if test="flowStep != null" >
      AND flow_step = #{flowStep,jdbcType=INTEGER}
    </if>
    <if test="status != null" >
      AND status = #{status,jdbcType=CHAR}
    </if>
    <if test="createtime != null" >
      AND createtime = #{createtime,jdbcType=TIMESTAMP}
    </if>
    <if test="updatetime != null" >
      AND updatetime = #{updatetime,jdbcType=TIMESTAMP}
    </if>
  </select>


  <select id="listByOrderFlow" resultMap="BaseResultMap" parameterType="com.xiaochong.loan.background.entity.po.OrderFlow" >
    select
    <include refid="Base_Column_List" />
    from loan_order_flow
    where 1=1
    <if test="id != null" >
      AND id = #{id,jdbcType=INTEGER}
    </if>
    <if test="orderNo != null" >
      AND order_no = #{orderNo,jdbcType=VARCHAR}
    </if>
    <if test="orderToken != null" >
      AND order_token = #{orderToken,jdbcType=VARCHAR}
    </if>
    <if test="merchId != null" >
      AND merch_id = #{merchId,jdbcType=INTEGER}
    </if>
    <if test="flowNo != null" >
      AND flow_no = #{flowNo,jdbcType=VARCHAR}
    </if>
    <if test="flowStep != null" >
      AND flow_step = #{flowStep,jdbcType=INTEGER}
    </if>
    <if test="status != null" >
      AND status = #{status,jdbcType=CHAR}
    </if>
    <if test="createtime != null" >
      AND createtime = #{createtime,jdbcType=TIMESTAMP}
    </if>
    <if test="updatetime != null" >
      AND updatetime = #{updatetime,jdbcType=TIMESTAMP}
    </if>
    ORDER BY flow_step
  </select>


  <select id="selectFlowByOrderNum" resultMap="BaseResultMap">
    SELECT
      <include refid="Base_Column_List"/>
    FROM loan_order_flow
    where order_no = #{orderNum}
  </select>


  <resultMap id="OrderFlowBackVoResultMap" type="com.xiaochong.loan.background.entity.vo.OrderFlowBackVo">
    <result column="orderNo" property="orderNo"/>
    <result column="merchantName" property="merchantName"/>
    <result column="flowName" property="flowName"/>
    <result column="status" property="status"/>
    <result column="realname" property="realname"/>
    <result column="idCard" property="idCard"/>
    <result column="phone" property="phone"/>
    <result column="createtime" property="createtime"/>
  </resultMap>
  <select id="getOrderFlowBackVoList" resultMap="OrderFlowBackVoResultMap">
    SELECT
    `of`.order_no orderNo,
    mi.merchant_name merchantName,
    cf.flow_name flowName,
    `of`.`status` status,
    o.realname realname,
    o.id_card idCard,
    o.phone phone,
    DATE_FORMAT(
    `of`.createtime,
    '%Y年%m月%d日 %h:%i:%s'
    ) createtime
    FROM
    `loan_order_flow` `of`
    LEFT JOIN loan_merchant_info mi ON `of`.merch_id = mi.id
    LEFT JOIN loan_checkflow cf ON `of`.flow_no = cf.flow_no
    LEFT JOIN loan_order o ON `of`.order_no = o.order_no
    WHERE  1=1
    <if test="null != status and '' != status">
      and `of`.status = #{status}
    </if>
    <if test="'orderNo' == searchStatus">
      <if test="null != condition and '' != condition">
        AND `of`.order_no = #{condition}
      </if>
    </if>
    <if test="'realname' == searchStatus">
      <if test="null != condition and '' != condition">
        AND o.realname = #{condition}
      </if>
    </if>
    <if test="'phone' == searchStatus">
      <if test="null != condition and '' != condition">
        AND o.phone = #{condition}
      </if>
    </if>
    <if test="'idCard' == searchStatus">
      <if test="null != condition and '' != condition">
        AND o.id_card = #{condition}
      </if>
    </if>

    <if test="null != startTime and '' != startTime">
      AND `of`.createtime &gt;= #{startTime}
    </if>
    <if test="null != endTime and '' != endTime">
      AND `of`.createtime &lt;= #{endTime}
    </if>
    ORDER BY `of`.createtime DESC
  </select>

</mapper>